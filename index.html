<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>sinatra-notebook by dukeoflaser</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">sinatra-notebook</h1>
      <h2 class="project-tagline">A small app for sharing lessons with music students.</h2>
      <a href="https://github.com/dukeoflaser/sinatra-notebook" class="btn">View on GitHub</a>
      <a href="https://github.com/dukeoflaser/sinatra-notebook/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/dukeoflaser/sinatra-notebook/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <p>As an individual who seems to have a lot of ducks that need aligning, proceeding with any given task or idea (case in point, this blog post) can seem futile if those ducks aren't in their rows. </p>

<p>There are a couple lines of thought that I've picked up from <a href="fourhourworkweek.com/blog/">Tim Ferriss</a> and <a href="http://blog.dilbert.com/">Scott Adams</a> that have helped me overcome the tendency of requiring my ducks to be in a row before starting a task. I'd like to apply to these approaches to this blog post and see how it turns out.</p>

<h3>
<a id="on-experimentation" class="anchor" href="#on-experimentation" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>On Experimentation</h3>

<p>After reading Tim Ferriss for a while, it has slowly dawned upon me that <em>experimentation</em> is a much more rewarding and feasible approach to acting on an idea than <strong>pre-action duck-alignment</strong> is. In fact, <em>agile development</em>, the software development approach of learning/navigating through rapid product testing and feedback loops is in effect, experimentation. Experimentation is a far more effective mindset for learning, for acting on ideas, and growing as a person than is perfectionist induced non-action. </p>

<h3>
<a id="on-evaluation" class="anchor" href="#on-evaluation" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>On Evaluation</h3>

<p>Tracking some kind of metric. Some metrics are more meaningful than others, and there is the possibility that choosing the wrong metric may cause damage (skewed data). But in this case, I believe any metric is better than nothing. A metric allows comparison and reveals progress or lack thereof.</p>

<h3>
<a id="on-goals" class="anchor" href="#on-goals" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>On Goals</h3>

<p>Goals are great, but many times you just don't know what the best goal truly is. Rather than being entirely goal oriented - that is focused on a single outcome, system orientation may help locate the best goal in times of uncertainty. </p>

<h3>
<a id="how-do-these-apply-to-this-blog-post" class="anchor" href="#how-do-these-apply-to-this-blog-post" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>How do these apply to this blog post?</h3>

<ul>
<li><p>I'm treating this blog post as the documentation of an experiment. Rather than trying to come off as a being any kind of authority on the use of Sinatra or it's sidekick gems, I am simply taking a look at what I learned from the process.</p></li>
<li><p>Tracking the number and type of things that cause me problems will allow me to see my own growth as a developer.</p></li>
<li><p>I do not yet know the outcome of this project or of this post. But I do know that simple documentation of successes and failures will be beneficial to my growth as a developer.</p></li>
</ul>

<hr>

<h3>
<a id="where-to-start-boilerplate-and-workflow" class="anchor" href="#where-to-start-boilerplate-and-workflow" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Where to start? Boilerplate and Workflow.</h3>

<h4>
<a id="what-im-happy-with" class="anchor" href="#what-im-happy-with" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>What I'm happy with.</h4>

<p>I started with a good idea of which gems I would be relying on, how to get a development database setup, and my general file requirements and dependencies. In my mind, the chain of dependencies, beginning when the app is run, looks like this:</p>

<div class="highlight highlight-source-ruby"><pre>dependencies <span class="pl-k">=</span> {
  <span class="pl-c1">:shotgun</span> =&gt; <span class="pl-c1">:config</span>,
  <span class="pl-c1">:config</span> =&gt; <span class="pl-c1">:app_controller</span>,
  <span class="pl-c1">:app_controller</span> =&gt; <span class="pl-c1">:environment</span>,
  <span class="pl-c1">:environment</span> =&gt; <span class="pl-c1">:gems</span>,
  <span class="pl-c1">:gems</span> =&gt; <span class="pl-c1">:bundler</span>
}</pre></div>

<p>Following that 'chain of command', I didn't have too much trouble getting Sinatra up and running.</p>

<p>As far as work flow is concerned, my tendency to get some ducks in a row paid off. Simply taking the time to create a rough mockup/flowchart gave me a good idea of what models, relationships, and views I was going to need.</p>

<p>Starting off by creating the models and their associations seemed like a no-brainer, but effectively creating controllers and views seemed to require more mixing and matching. In the end, I sketched in the routes for each controller, and then introduced functionality to the views on an 'as-needed' basis. </p>

<h4>
<a id="what-i-could-have-done-better" class="anchor" href="#what-i-could-have-done-better" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>What I could have done better.</h4>

<p>Once I got my core files and directories set up, I should have saved them to an additional repository as a staring point for any future Sinatra projects. </p>

<p>I did find <a href="http://ashleygwilliams.github.io/ratpack/">this</a> boilerplate, however, which is similar to what I put together. I will probably give this a whirl next time around, although I think there is something to be said for crafting one's own set of tools if possible.</p>

<h3>
<a id="modeling---sinatra-and-high-fashion" class="anchor" href="#modeling---sinatra-and-high-fashion" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Modeling - Sinatra and High Fashion</h3>

<h4>
<a id="what-im-happy-with-1" class="anchor" href="#what-im-happy-with-1" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>What I'm happy with.</h4>

<p>The way in which the models were able to interact with each other through their associations went exactly as planned and I had little trouble, if any, accessing data from any of the tables in any given situation. Part of that is due to <a href="http://dukeoflaser.github.io/ActiveRecordAssociations">this experiment</a> I did with ActiveRecord's associations.</p>

<p>Currently, however, the models are also an area that I feel are the root of the apps biggest flaw.</p>

<h4>
<a id="what-i-could-have-done-better-1" class="anchor" href="#what-i-could-have-done-better-1" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>What I could have done better.</h4>

<p>The problem is that a teacher and a student can have the same user id. As they each have separate tables in the database, the first teacher to signup gets an <code>id</code> of 1 as does the first student. This causes no problems for the normal flow of the app, but what happens when the student logs in and manually types in <code>.../teacher/home</code> to the URL bar?</p>

<p>Well, unfortunately, teacher and student specific routes depend upon the existence of a user id but are indiscriminate about the type of user.</p>

<div class="highlight highlight-source-ruby"><pre>get <span class="pl-s"><span class="pl-pds">'</span>/teacher/home<span class="pl-pds">'</span></span> <span class="pl-k">do</span>
  <span class="pl-k">unless</span> session[<span class="pl-c1">:user_id</span>].nil?
    <span class="pl-smi">@user</span> <span class="pl-k">=</span> <span class="pl-c1">Teacher</span>.find_by_id(session[<span class="pl-c1">:user_id</span>])
    <span class="pl-c">#...</span>
<span class="pl-k">end</span></pre></div>

<p>I think the solution to this will be simple enough, however. Upon login, a session variable containing the <code>user_type</code> needs to be set, and then checked when any teacher or student specific page is accessed.</p>

<hr>

<p><strong>Edit:</strong> I felt as though this issue did not allow the app fall under the 'Good Enough' category so I implemented the above solution and it does seem to solve the problem.</p>

<hr>

<p>A session variable is set upon login.</p>

<div class="highlight highlight-source-ruby"><pre>  <span class="pl-k">if</span> user.is_a? <span class="pl-c1">Teacher</span>
    session[<span class="pl-c1">:user_type</span>] <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>teacher<span class="pl-pds">'</span></span>
    redirect <span class="pl-s"><span class="pl-pds">"</span>/teacher/home<span class="pl-pds">"</span></span>
  <span class="pl-k">elsif</span> user.is_a? <span class="pl-c1">Student</span>
    session[<span class="pl-c1">:user_type</span>] <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>student<span class="pl-pds">'</span></span>
    redirect <span class="pl-s"><span class="pl-pds">"</span>/student/lessons<span class="pl-pds">"</span></span>
  <span class="pl-k">end</span></pre></div>

<p><code>valid_teacher</code> and <code>valid_student</code> helper methods are created in corresponding controllers.</p>

<div class="highlight highlight-source-ruby"><pre>  <span class="pl-k">def</span> <span class="pl-en">valid_teacher</span>
    session[<span class="pl-c1">:user_id</span>].nil? <span class="pl-k">||</span> session[<span class="pl-c1">:user_type</span>] <span class="pl-k">!=</span> <span class="pl-s"><span class="pl-pds">'</span>teacher<span class="pl-pds">'</span></span> <span class="pl-k">?</span> <span class="pl-c1">false</span> : <span class="pl-c1">true</span>
  <span class="pl-k">end</span></pre></div>

<div class="highlight highlight-source-ruby"><pre>  <span class="pl-k">def</span> <span class="pl-en">valid_student</span>
    session[<span class="pl-c1">:user_id</span>].nil? <span class="pl-k">||</span> session[<span class="pl-c1">:user_type</span>] <span class="pl-k">!=</span> <span class="pl-s"><span class="pl-pds">'</span>student<span class="pl-pds">'</span></span> <span class="pl-k">?</span> <span class="pl-c1">false</span> : <span class="pl-c1">true</span>
  <span class="pl-k">end</span></pre></div>

<p>Each teacher/student specific route now uses some control flow to either go ahead with the route logic or redirect back to the login page, depending on the outcome of the validation method.</p>

<div class="highlight highlight-source-ruby"><pre>  get <span class="pl-s"><span class="pl-pds">'</span>/teacher/home<span class="pl-pds">'</span></span> <span class="pl-k">do</span>
    <span class="pl-k">if</span> valid_teacher
      <span class="pl-smi">@user</span> <span class="pl-k">=</span> <span class="pl-c1">Teacher</span>.find_by_id(session[<span class="pl-c1">:user_id</span>])
      session[<span class="pl-c1">:student_id</span>] <span class="pl-k">=</span> <span class="pl-c1">nil</span>
      erb <span class="pl-c1">:'/teacher/home'</span>
    <span class="pl-k">else</span>
      redirect <span class="pl-s"><span class="pl-pds">'</span>/login<span class="pl-pds">'</span></span>
    <span class="pl-k">end</span>
  <span class="pl-k">end</span></pre></div>

<h3>
<a id="multiple-controllers---configuration" class="anchor" href="#multiple-controllers---configuration" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Multiple Controllers - Configuration.</h3>

<h4>
<a id="what-im-happy-with-2" class="anchor" href="#what-im-happy-with-2" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>What I'm happy with.</h4>

<p>I was tempted to dump all my routes into the main app controller, but after completing the project and looking at the files, I'm glad I didn't. In this case, having a modular structure seems like the best way to go.</p>

<h4>
<a id="what-i-could-have-done-better-2" class="anchor" href="#what-i-could-have-done-better-2" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>What I could have done better.</h4>

<p>When setting the configuration block for the main App Controller, I initially assumed that those configurations would be global, and apply to my other controllers. </p>

<div class="highlight highlight-source-ruby"><pre>  configure <span class="pl-k">do</span>
    set <span class="pl-c1">:public_folder</span>, <span class="pl-s"><span class="pl-pds">'</span>public<span class="pl-pds">'</span></span>
    set <span class="pl-c1">:views</span>, <span class="pl-s"><span class="pl-pds">'</span>app/views<span class="pl-pds">'</span></span>
    enable <span class="pl-c1">:sessions</span>
    set <span class="pl-c1">:session_secret</span>, <span class="pl-s"><span class="pl-pds">'</span>its_a_secret<span class="pl-pds">'</span></span>
    register <span class="pl-c1">Sinatra</span>::<span class="pl-c1">Flash</span>
  <span class="pl-k">end</span></pre></div>

<p>When I realized that was not the case, I experimented with the <code>config.ru</code> file to no avail. I settled on simply including the configuration block in each and every controller. That, however, seems like a bit of a code smell and I have a sneaking suspicion there is a cleaner way of achieving the same results in a less redundant manner. What that manner is though, I don't yet know.</p>

<p>I also had an issue with '<a href="http://stackoverflow.com/questions/735073/best-way-to-require-all-files-from-a-directory-in-ruby">properly</a>' requiring relative files. I could get the 'improper' method working, </p>

<div class="highlight highlight-source-ruby"><pre><span class="pl-c1">Dir</span>[<span class="pl-s"><span class="pl-pds">"</span>./app/controllers/*.rb<span class="pl-pds">"</span></span>].each {|<span class="pl-smi">file</span>| <span class="pl-k">require</span> file }</pre></div>

<p>but ended up with an error message when using the following 'proper' technique. </p>

<div class="highlight highlight-source-ruby"><pre><span class="pl-c1">Dir</span>[<span class="pl-c1">File</span>.dirname(<span class="pl-v">__FILE__</span>) <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">'</span>./app/controllers/*.rb<span class="pl-pds">'</span></span>].each {|<span class="pl-smi">file</span>| <span class="pl-k">require</span> file }</pre></div>

<p>Digging in to both statements with <code>pry</code> indicated both were returning the same array of files so it remains a mystery to me as to why the second one failed. At the end of the day I used the <code>require_all</code> gem. That tidy's things up nicely, but is likely heavy handed for requiring a minimal number of files.</p>

<h3>
<a id="sessions-vs-dynamic-urls" class="anchor" href="#sessions-vs-dynamic-urls" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Sessions vs Dynamic URLs</h3>

<h4>
<a id="what-im-happy-with-3" class="anchor" href="#what-im-happy-with-3" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>What I'm happy with.</h4>

<p>I'm happy with the final outcome. For the most part.</p>

<h4>
<a id="what-i-could-have-done-better-3" class="anchor" href="#what-i-could-have-done-better-3" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>What I could have done better.</h4>

<p>I could have saved myself some time and started with the proper url structure in the first place. Instead, I started off using dynamic urls, exclusively. Even for the teacher <code>id</code> when I was actually relying on a session to provide the id.
For example, I had something like this:</p>

<div class="highlight highlight-source-ruby"><pre>get <span class="pl-s"><span class="pl-pds">'</span>/teacher/:id/home<span class="pl-pds">'</span></span> <span class="pl-k">do</span>
  <span class="pl-smi">@user</span> <span class="pl-k">=</span> <span class="pl-c1">Teacher</span>.find_by_id(session[<span class="pl-c1">:user_id</span>])
  <span class="pl-c">#...</span>
<span class="pl-k">end</span>  </pre></div>

<p>The amount of sense that makes is, to put it mildly, not a lot. At no point was I ever making use of <code>params[:id]</code>. I'm ashamed to admit how many routes I had going before I realized the pointlessness of that <code>:id</code> parameter. Let's just say, the sheer number of <code>&lt;%= @user.id %&gt;</code>s in my view's hyperlinks was beginning to give me claustrophobia.</p>

<p>Once I got rid of those unneeded parameters, particularly for both teachers and students, my routes and my view templates had some room to breath.</p>

<h3>
<a id="keeping-it-dry" class="anchor" href="#keeping-it-dry" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Keeping it DRY</h3>

<h4>
<a id="what-im-happy-with-4" class="anchor" href="#what-im-happy-with-4" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>What I'm happy with.</h4>

<p>I did manage to re-use several templates here and there, and I implemented a basic layout template to reduce the amount of repeat markup. Additionally, I was able to implement a number of helper methods that were used by multiple forms such as email validation and password confirmation.</p>

<h4>
<a id="what-i-could-have-done-better-4" class="anchor" href="#what-i-could-have-done-better-4" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>What I could have done better.</h4>

<p>I believe there is a lot of room for improvement here. As far as the markup for the views go, the top and bottom navigation bars should probably have gotten their own template, and I could probably have used two distinct layout types - one for forms, one for the rest of the app. That would have reduced some of of the repetitive markup used to centre the elements on the page and would clean up the logic used for displaying flash messages.</p>

<p>One thing that bugs me, that has a bit of a code smell to it, is the repetition of a couple of helper methods. In fact, each controller has the exact same <code>invalid_email?</code> helper method. </p>

<div class="highlight highlight-source-ruby"><pre>helpers <span class="pl-k">do</span>
  <span class="pl-k">def</span> <span class="pl-en">invalid_email?</span>(<span class="pl-smi">submitted_email</span>)
    valid_email <span class="pl-k">=</span> <span class="pl-sr"><span class="pl-pds">/</span><span class="pl-cce">\A</span><span class="pl-pds">[<span class="pl-cce">\w</span>+<span class="pl-cce">\-</span>.]</span>+@<span class="pl-pds">[a-z<span class="pl-cce">\d\-</span>]</span>+<span class="pl-sr">(<span class="pl-cce">\.</span><span class="pl-pds">[a-z]</span>+)</span>*<span class="pl-cce">\.</span><span class="pl-pds">[a-z]</span>+<span class="pl-cce">\z</span><span class="pl-pds">/i</span></span>
    submitted_email.match(valid_email).nil?
  <span class="pl-k">end</span>
<span class="pl-k">end</span></pre></div>

<p>To really tighten this down I would need either a module or Helper class that I could <code>include</code> or reference. I know Sinatra includes a <code>helpers</code> block for each controller, but it would be nice (and maybe it does) if it included a location for some more universal helper methods.</p>

<h3>
<a id="final-thoughts" class="anchor" href="#final-thoughts" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Final Thoughts</h3>

<p>All in all I'm happy with this app and the fact that I was able to build it 'from scratch'. It's hardly from scratch but compared to other things I've made, it seems like it is. My confidence level has increased, my security with manipulating data has grown, and I've also discovered things that I want to figure out down the road.</p>

<p>This app is overly simple and doesn't solve any real problem, except perhaps, a student forgetting their super simple paper notebook. Still, I think there does remain plenty of room for expansion into something useful if time and effort were put into furthering this project.</p>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/dukeoflaser/sinatra-notebook">sinatra-notebook</a> is maintained by <a href="https://github.com/dukeoflaser">dukeoflaser</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>
